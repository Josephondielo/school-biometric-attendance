services:
  # 1. Main Backend API (Lightweight)
  - type: web
    name: attendance-api
    runtime: docker
    dockerContext: backend
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: attendance-db
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: BIOMETRIC_SERVICE_URL
        fromService:
          type: web
          name: biometric-service
          property: host
      - key: BIOMETRIC_API_KEY
        value: "supersecret-key" # Recommended: Change this to a random string
      - key: PORT
        value: 8000

  # 2. Biometric Service (Heavy ML)
  - type: web
    name: biometric-service
    runtime: docker
    dockerContext: biometric-service
    envVars:
      - key: BIOMETRIC_API_KEY
        value: "supersecret-key"
      - key: PORT
        value: 5000

  # 3. Frontend (Static Site)
  - type: web
    name: attendance-frontend
    runtime: static
    buildCommand: "cd frontend && npm install && npm run build"
    staticPublishPath: "frontend/dist"
    envVars:
      - key: VITE_API_BASE_URL
        fromService:
          type: web
          name: attendance-api
          property: host

databases:
  - name: attendance-db
    plan: free
